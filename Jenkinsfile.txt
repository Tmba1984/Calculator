pipeline{
	agent any
	
	stages{
		stage('Git-Checkout'){
			steps{
			
				checkout changelog: true, poll: true, scm: [
				$class: 'GitSCM',
				branches: [[name: "origin/${env.gitlabSourceBranch}"]],
				extensions: [[$class: 'PreBuildMerge', options: [fastForwardMode: 'FF', mergeRemote: 'origin', mergeStrategy: 'DEFAULT', mergeTarget: "${env.gitlabTargetBranch}"]]],
				userRemoteConfigs: [[name: 'origin', url: 'git@github.com:Tmba1984/Calculator.git']]
				]
			}
		
		}
		stage('Build'){
			steps{
				echo "Building the checking out project"
				bat 'mvn clean compile'
			}
		}
		stage('Test'){
			steps{
				echo "Running tests"
				bat 'mvn test'
			}
			
			post{
				always{
					junit '**/target/surefire-reports/TEST-*.xml'
				}
			}
		}

	}
}